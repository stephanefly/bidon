{% extends 'trunks/main/base.html' %}
{% block content %}

<div class="text-center mb-4">
    <h2 class="fw-bold">Utilitaire<span class="text-primary"> Y+ to Y</span></h2>
    <p class="mt-3">Calculatrice de taille de première maille à partir d'un BSAM</p>
    <p>
        <a href="https://improve.idhall.com/idea/view.php?ide_id=275139&vw_tab=about"
           target="_blank" rel="noopener noreferrer">
            Lien vers l’IP
        </a>
    </p>
</div>

<!-- FORMULAIRE DANS LE CONTAINER -->
<div class="container d-flex justify-content-center align-items-center" style="padding: 20px">
    <div class="col-12 col-md-6">

        <form method="post">
            {% csrf_token %}

            <!-- BSAM -->
            <div class="mb-3 text-start">
                <label class="form-label">Chemin du fichier BSAM</label>
                <input type="text"
                       class="form-control"
                       name="bsam_path"
                       value="{{ bsam_path }}"
                       required>
            </div>

            <!-- Y+ -->
            <div class="mb-3 text-start">
                <label class="form-label">Y+ cible</label>
                <input type="number"
                       class="form-control"
                       name="y_value"
                       value="{{ y_value|default:1 }}"
                       min="0"
                       step="0.1">
            </div>

            <button type="submit"
                    name="action"
                    value="compute"
                    class="btn btn-primary w-100">
                Lancer le calcul
            </button>
        </form>

    </div>
</div>
<hr>
<!-- TABLEAU + EXPORT EN DEHORS DU CONTAINER -->
{% if rows %}
<div class="container mt-4" style="padding-top: 10px">

        <!-- Résumé après calcul -->
        <div class="mt-4 card shadow-sm border-0 rounded-top-3">
            <div class="card-body">
                <div class="mb-3">
                    <div class="text-muted small">Chemin du BSAM</div>
                    <div class="fw-bold" style="word-break: break-all;">
                        {{ bsam_path }}
                    </div>
                </div>

                <div>
                    <div class="text-muted small">Y+ utilisé</div>
                    <div class="fw-bold fs-4" style="color:#471448;">
                        {{ y_value }}
                    </div>
                </div>
            </div>
        </div>

    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <thead style="background:#471448; color:white;">
                <tr>
                    <th>Grille</th>
                    <th>y+</th>
                    <th>y (µm)</th>
                    <th>cf</th>
                    <th>utau/Uref (%)</th>
                    <th>Uref (m/s)</th>
                    <th>utau (m/s)</th>
                    <th>Corde (mm)</th>
                    <th>Reynolds</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                <tr>
                    {% for col in row %}
                    <td>{{ col }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- BOUTON EXPORT EXCEL -->
    <form method="post" class="mt-3">
        {% csrf_token %}
        <input type="hidden" name="bsam_path" value="{{ bsam_path }}">
        <input type="hidden" name="y_value" value="{{ y_value }}">
        <input type="hidden" name="action" value="export_excel">

        <div class="row mt-3">
            <div class="col-12 d-flex justify-content-center">
                <button type="submit" class="btn btn-outline-success w-50">
                    Exporter en Excel
                </button>
            </div>
        </div>
    </form>

</div>
{% endif %}

{% endblock %}
