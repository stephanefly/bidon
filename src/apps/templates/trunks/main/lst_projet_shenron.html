{% extends 'trunks/main/base.html' %}
{% load static %}
{% block content %}
<div class="text-center mb-4">
   <h2 class="fw-bold">Liste de vos projets <span class="text-primary">ShenRON</span></h2>
   <p class="mt-3">Description de l'outil</p>
</div>
<br>
<button type="button" class="btn btn-primary" data-bs-toggle="modal"
   data-bs-target="#createProjetShenronModal">
Nouveau Projet Shenron
</button>
<br>
<hr>
<table id="tableprojetshenron" class="table table-bordered table-striped">
   <thead>
      <th>Nom</th>
      <th>Créé par</th>
      <th>Créé le</th>
      <th>Dossier de travail</th>
      <th>Actions</th>
   </thead>
   <tbody>
      {% for projet in lst_projets_shenron %}
      <tr>
         {% url 'lst_projets_shenron' as url %}
         <td>
            <a href="{{ url }}{{ projet.id }}">{{ projet.name }}</a>
         </td>
         <td>{{ projet.created_by }}</td>
         <td>{{ projet.created_at }}</td>
         <td>

             <!-- Copier Repertoire de travail -->
<button onclick="copyToClipboard('{{ projet.work_dir|escapejs }}')" 
        class="btn btn-primary"
        style="border-width: 2px; padding: 8px 14px; font-weight: 500;">
    
    <i class="bi bi-folder"></i> 
    <span>Dossier de travail</span>

</button>
         </td>
         <td>
            <a data-bs-toggle="modal"
               data-bs-target="#renameProjetShenronModal-{{ projet.id }}"
               title="Renommer">
            <button type="button" class="btn btn-primary btn-sm">
            <i class="bi bi-pencil-fill"></i>
            </button>
            </a>
            <a href="{% url 'delete_projet_shenron' projet.id %}" 
               class="btn btn-danger btn-sm"
               onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce projet ?');"
               title="Supprimer">
            <i class="bi bi-trash-fill"></i>
            </a>
            <div class="modal fade"
               id="renameProjetShenronModal-{{ projet.id }}" tabindex="-1"
               aria-labelledby="renameProjetShenronModalLabel-{{ projet.id }}"
               aria-hidden="true">
               <div class="modal-dialog">
                  <div class="modal-content">
                     <form method="post"
                        action="{% url 'rename_projet_shenron' projet.id %}">
                        {% csrf_token %}
                        <div class="modal-header">
                           <h5 class="modal-title"
                              id="renameProjetShenronModalLabel-{{ projet.id }}">
                              Renommer le projet : {{ projet.name }}
                           </h5>
                           <button type="button" class="btn-close"
                              data-bs-dismiss="modal"
                              aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                           <div class="form-floating mb-3">
                              <input type="text" name="new_name"
                                 class="form-control"
                                 id="floatingNewName-{{ projet.id }}"
                                 placeholder="Nouveau nom"
                                 required>
                              <label for="floatingNewName-{{ projet.id }}">
                              Nouveau nom
                              </label>
                           </div>
                        </div>
                        <div class="modal-footer">
                           <button type="button"
                              class="btn btn-secondary"
                              data-bs-dismiss="modal">Annuler
                           </button>
                           <button type="submit"
                              class="btn btn-primary">Renommer
                           </button>
                        </div>
                     </form>
                  </div>
               </div>
            </div>
         </td>
      </tr>
      {% endfor %}
   </tbody>
</table>
<!-- Modal Création -->
<div class="modal fade" id="createProjetShenronModal" tabindex="-1"
   aria-labelledby="createProjetShenronModalLabel"
   aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <form method="post" action="{% url 'lst_projets_shenron' %}">
            {% csrf_token %}
            <div class="modal-header">
               <h5 class="modal-title" id="createProjetShenronModalLabel">
                  Créer un nouveau Projet Shenron
               </h5>
               <button type="button" class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
               {{ form.as_p }}
            </div>
            <div class="modal-footer">
               <button type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal">Annuler
               </button>
               <button type="submit"
                  class="btn btn-primary">Créer
               </button>
            </div>
         </form>
      </div>
   </div>
</div>
<script>
   function copyToClipboard(text) {
       // Copie dans le presse-papier
       navigator.clipboard.writeText(text).then(function() {
           afficherNotif2("Copié dans le presse-papier : " + text);
       }, function() {
           afficherNotif2("Erreur lors de la copie !");
       });
   }
   
   function afficherNotif2(message) {
       let notif = document.getElementById('custom-notif');
       if (!notif) {
           notif = document.createElement('div');
           notif.id = 'custom-notif';
           notif.style.position = 'fixed';
           notif.style.top = '20px';
           notif.style.right = '20px';
           notif.style.minWidth = '250px';
           notif.style.zIndex = 99999;
           notif.style.padding = '16px 18px';
           notif.style.borderRadius = '12px';
           notif.style.fontSize = '1rem';
           notif.style.color = '#fff';
           notif.style.fontWeight = "bold";
           notif.style.background = "#471448";
           notif.style.boxShadow = '0 2px 10px rgba(0,0,0,0.11)';
           document.body.appendChild(notif);
       }
       notif.innerHTML = message;
       notif.style.display = 'block';
   
       // Disparition auto après 2,5 secondes
       setTimeout(function() {
           notif.style.display = "none";
       }, 2500);
   }
</script>
{% endblock %}